@model List<ListingProjectsDTO>
@{
  ViewData["Title"] = "Dashboard";
  //var listingMd = Model?.FirstOrDefault();
}
<!DOCTYPE html>
<html>
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width"/>
    <title>TestDashboard1</title>
    <style>
        .listing {
            margin: 10px;
            padding: 10px;
            width: 45%; /* Make each listing take up roughly half the container */
            border: 1.5px outset darkgray;
            box-shadow: 0 0 2px #aca9a9;
            border-radius: 6px;
        }
        .wrapper {
            display: flex;
            flex-wrap: wrap; /* Allows listings to wrap to the next line if necessary */
            gap: 10px; /* Adds spacing between listing items */
        }
        .listing img {
            width: 100%;
            height: auto;
        }
        .roundPlaceholder {
            width: 60px;
            height: 20px;
            background: #a84909;
            border-radius: 10px;
        }
        .roundPlaceholderTxt {
            font-size: 10px;
            font-family: Arial;
            text-align: center;
            color: aliceblue;
        }
        .listingPhoto {
            text-align: center;
            width: 100%;
        }
    </style>
</head>
<body>
<div class="wrapper">
    @foreach (var listingMd in Model)
    {
        @if (listingMd != null)
        {
            <div class="listing" method="post" action="@Url.Action("Update","Staff")">
                <p>Listing is not null</p>
                <div><img class="listingPhoto" src="~/imgSearchHome/IMG_20220102_161928.jpg" /></div>
                <input type="hidden" name="Id" value="@Model." />
                <div>
                    <p>Test index: @(listingMd.ListingName_DTO ?? "null null")</p>
                    <p>Age: @(listingMd.ListingId != null ? listingMd.ListingId.ToString() : "Not Provided")</p>
                    <div class="roundPlaceholder">
                        <p class="roundPlaceholderTxt">Book me</p>
                    </div>
                    <div class="deleteListingBtn">
                        <a type="button" class="delete" data-entity-id="@listingMd.ListingId" class="btn btn-danger">Delete</a>
                    </div>
                    <div class="editListingBtn">
                        <a type="button" class="edit" href="@Url.Action("Edit","Home",new {id=listingMd.ListingId})" class="btn btn-danger">EditAction</a>
                        @Html.ActionLink("Edit", "Edit", new {id=listingMd.ListingId })
                    </div>
            
                    <p>Location: @(listingMd.ListingId!= null ? listingMd.ListingId.ToString() : "Not Provided")</p>
                </div>
            </div>
        }
        else
        {
            <p>No listings available.</p>
        }
    }
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $(".delete").click(function (e) {
            e.preventDefault(); // Prevent default action

            var button = $(this); // Reference the clicked button
            var id = button.data("entity-id"); // Get the ID from data-entity-id attribute

            $.ajax({
                type: "POST",
                url: "@Url.Action("DeleteDetails", "Home")", // Correct action for deletion
                data: {
                    id: id,
                    __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() // Anti-forgery token
                },
                dataType: "json", // Expect JSON response
                success: function (data, status, xhr) {
                    if (data === "success!") {
                        button.closest(".listing").hide("slow"); // Hide card on success
                    } else {
                        alert("Error: " + data); // Display error message
                    }
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + status + " " + error + " " + xhr.status + " " + xhr.statusText);
                }
            });
        });
    });
</script>


</body>
</html>
